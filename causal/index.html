<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Causal ordering &mdash; msg-notes 0.0.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="msg-notes 0.0.0 documentation" href="../index.html" />
    <link rel="next" title="Ordering" href="01-ordering.html" />
    <link rel="prev" title="Topics in secure messaging systems" href="../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="01-ordering.html" title="Ordering"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../index.html" title="Topics in secure messaging systems"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">msg-notes 0.0.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="causal-ordering">
<h1>Causal ordering<a class="headerlink" href="#causal-ordering" title="Permalink to this headline">Â¶</a></h1>
<p>We&#8217;ll begin by describing a few properties that we would like our messaging
system to have. In general, messages are not self-contained but implicitly
refer to previous messages (their &#8220;context&#8221; or &#8220;causes&#8221;), and this is critical
to their meaning. A &#8220;context rebinding&#8221; attack (which includes replay attacks)
presents a message to the victim recipient under a different context, in the
hope that the latter interprets it differently from what its author intended.
We&#8217;d like to guarantee not only a message&#8217;s contents, but its context as well.</p>
<p>We&#8217;d also like members to be able to send messages without requiring approval
from others (or the system as a whole, or any other entity) - or equivalently,
potentially having messages rejected by them. Another nice property is to have
a total (linear) order for our messages, that is globally-consistent.</p>
<p>Our first obstacle is that we cannot achieve all three properties. <a class="footnote-reference" href="#nordp" id="id1">[1]</a> So
which one shall we abandon? If we abandon the no-approval property, then we can
achieve the others, by using some mechanism (e.g. a consensus protocol) to
approve one message at a time in sequence. However, this has several downsides.
It requires interaction with other members of the session <em>for every single
message</em>, which is not feasible in an asynchronous scenario. Rejections must be
handled manually <a class="footnote-reference" href="#narej" id="id2">[2]</a> in the UI, but we consider this an unacceptable user
experience. Finally, the guarantees of consensus algorithms are much lower than
the computational security guarantees we can achieve when preserving context.</p>
<p>We consider it unacceptable to abandon the context-preserving property, since
this is a security issue. To abandon the globally-consistent total order has
much less severe consequences. In the messaging layer itself, all the session
mechanics may be executed, and all the security properties reasoned about, in
terms of the context-preserving partial (causal) order of messages. Then, in
the UI layer, we can recover most of the UX advantage that total orders have
over partial orders, by using a subjective (non-global) linearisation of the
&#8220;true&#8221; order. The rest of this chapter will explore these topics.</p>
<p>Certain strategies we discuss may not be appropriate for some applications. For
example, we temporarily prevent some messages from being displayed in the UI.
Applications that can accept weaker ordering guarantees, such as streaming
non-sensitive video, may prefer to avoid this and choose a different scheme.</p>
<p>Some key-rotation ratchets implicitly preserve context, since the dependencies
of which previous keys are used to protect each message matches the actual
causal order of messages. Our explicit formal treatment here works outside of
any ratchet, but we&#8217;ll return to the relationships between ratchet message
dependency and causal orders in <a class="reference internal" href="../ratchet.html"><em>another chapter</em></a>.</p>
<p>We also explore more complex mechanics. For concurrent membership operations,
we derive a merge algorithm over causal orders that satisfies intuitive notions
of quasi-global consistency. Our analysis includes conditions on how to encode
a global state to be compatible with this algorithm, which may be useful for
policy-enforced membership operations. TODO(xl): reword this later</p>
<table class="docutils footnote" frame="void" id="nordp" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>The basic distributed case is where two members each publish a
message with the same context O, call these a, b, without having seen the
other message first. Forcing these into a total order, WLOG say (O, a, b),
would add a to the apparent context of b, potentially causing it to be
interpreted incorrectly. Note that this holds regardless of how the total
order is formed - including e.g. by reflecting all messages via a server or
leader - as long as we don&#8217;t require approvals or allow rejections.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="narej" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>Automatic retries are effectively a context rebinding attack upon
yourself. Say we try to send a message m with context O and it is rejected.
This means some other message m&#8217; was accepted also with context O. If we
automatically retry m now, it will have m&#8217; in its context, even though the
author of m originally wrote it without such a context.</td></tr>
</tbody>
</table>
<p>Subtopics:</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="01-ordering.html">Ordering</a><ul>
<li class="toctree-l2"><a class="reference internal" href="01-ordering.html#data-structures">Data structures</a><ul>
<li class="toctree-l3"><a class="reference internal" href="01-ordering.html#partial-orders">Partial orders</a></li>
<li class="toctree-l3"><a class="reference internal" href="01-ordering.html#causal-orders">Causal orders</a></li>
<li class="toctree-l3"><a class="reference internal" href="01-ordering.html#invariants">Invariants</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="01-ordering.html#enforcement">Enforcement</a><ul>
<li class="toctree-l3"><a class="reference internal" href="01-ordering.html#detecting-transport-attacks">Detecting transport attacks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="01-ordering.html#buffering-and-asynchronous-operation">Buffering and asynchronous operation</a></li>
<li class="toctree-l2"><a class="reference internal" href="01-ordering.html#the-importance-of-strong-ordering">The importance of strong ordering</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="02-consistency.html">Consistency</a><ul>
<li class="toctree-l2"><a class="reference internal" href="02-consistency.html#reliability-and-consistency">Reliability and consistency</a></li>
<li class="toctree-l2"><a class="reference internal" href="02-consistency.html#acks-and-full-ack">Acks and full-ack</a><ul>
<li class="toctree-l3"><a class="reference internal" href="02-consistency.html#ack-monitors">Ack monitors</a></li>
<li class="toctree-l3"><a class="reference internal" href="02-consistency.html#ack-semantics">Ack semantics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="02-consistency.html#timing-concepts">Timing concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="02-consistency.html#resends-and-duplicates">Resends and duplicates</a><ul>
<li class="toctree-l3"><a class="reference internal" href="02-consistency.html#single-ciphertext-principle">Single-ciphertext principle</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="02-consistency.html#transcript-consistency">Transcript consistency</a></li>
<li class="toctree-l2"><a class="reference internal" href="02-consistency.html#future-extensions">Future extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="02-consistency.html#rejected-ideas">Rejected ideas</a><ul>
<li class="toctree-l3"><a class="reference internal" href="02-consistency.html#transport-level-reliability">Transport-level reliability</a></li>
<li class="toctree-l3"><a class="reference internal" href="02-consistency.html#consistency-vs-consensus">Consistency vs consensus</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="03-freshness.html">Freshness and presence</a><ul>
<li class="toctree-l2"><a class="reference internal" href="03-freshness.html#non-causal-drops">Non-causal drops</a><ul>
<li class="toctree-l3"><a class="reference internal" href="03-freshness.html#heartbeats">Heartbeats</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="03-freshness.html#presence-and-expiry">Presence and expiry</a><ul>
<li class="toctree-l3"><a class="reference internal" href="03-freshness.html#intended-absence">Intended absence</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="03-freshness.html#timestamps">Timestamps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="03-freshness.html#limitations">Limitations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="04-state.html">Pseudo-mutable state</a><ul>
<li class="toctree-l2"><a class="reference internal" href="04-state.html#union-of-events-vs-pseudo-mutable-shared-state">Union of events vs pseudo-mutable shared state</a></li>
<li class="toctree-l2"><a class="reference internal" href="04-state.html#global-state">Global state</a></li>
<li class="toctree-l2"><a class="reference internal" href="04-state.html#way-merge">3-way merge</a><ul>
<li class="toctree-l3"><a class="reference internal" href="04-state.html#possible-state-types">Possible state types</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="04-state.html#general-merge-algorithm-for-dags">General merge algorithm for DAGs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="04-state.html#commutativity-and-associativity">Commutativity and associativity</a></li>
<li class="toctree-l3"><a class="reference internal" href="04-state.html#history-matters">History matters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="05-visibility.html">Partial visibility</a><ul>
<li class="toctree-l2"><a class="reference internal" href="05-visibility.html#member-sets">Member-sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="05-visibility.html#operations-on-the-causal-order">Operations on the causal order</a></li>
<li class="toctree-l2"><a class="reference internal" href="05-visibility.html#subjective-vs-objective-views">Subjective vs objective views</a></li>
<li class="toctree-l2"><a class="reference internal" href="05-visibility.html#merge-algorithm">Merge algorithm</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="06-application.html">Applications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="06-application.html#real-world-multi-user-chat">Real-world multi-user chat</a></li>
<li class="toctree-l2"><a class="reference internal" href="06-application.html#handling-concurrency">Handling concurrency</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="07-interface.html">User interface and workflows</a><ul>
<li class="toctree-l2"><a class="reference internal" href="07-interface.html#displaying-a-causal-order">Displaying a causal order</a><ul>
<li class="toctree-l3"><a class="reference internal" href="07-interface.html#delivery-order">Delivery order</a></li>
<li class="toctree-l3"><a class="reference internal" href="07-interface.html#server-dictated-order">Server-dictated order</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="07-interface.html#others">Others</a></li>
</ul>
</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="../index.html"
                        title="previous chapter">Topics in secure messaging systems</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="01-ordering.html"
                        title="next chapter">Ordering</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/causal/index.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="01-ordering.html" title="Ordering"
             >next</a> |</li>
        <li class="right" >
          <a href="../index.html" title="Topics in secure messaging systems"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">msg-notes 0.0.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014-2015 Mega Limited, licensed under CC-BY-SA-4.0.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>